using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.IO.Ports;
using System.Threading;
using System.IO;

namespace WindowsFormsApplication1
{

	public partial class Form1 : Form
	{
		public Form1()
		{
			InitializeComponent();

		}
		int[] Rarray = {
    1000, //0  102
    2700, //1  272
    4700, //2  472
    6800, //3  682
   10000, //4  103
   22000, //5  223
   47000, //6  473
   75000, //7  753
  100000, //8  104
  220000, //9  224
  470000, //10 474
   75000, //11 753
    4700, //12 472
    1000, //13 102
   10000, //14 103
  100000 //15 104
		};

		class value
		{
			public double voltage;
			public int conf;
			public int iv;
			public double cur;
			public double error;
		}
		value[] values = new value[257];

		/*
0	0	0	0	0
255	0.048528846	0.003093142	255.0485288	31743
1	0.046061853	0.003399386	1.046061853	128
254	0.002466993	0.006467155	254.002467	29695
2	0.025859634	0.006558133	2.025859634	576
253	0.022669213	0.009602137	253.0226692	31167
3	0.04359486	0.009813273	3.04359486	3456
252	0.071703892	0.012621463	252.0717039	62271
4	0.017828482	0.012904542	4.017828482	35712
251	0.031206197	0.015898643	251.0312062	62943
5	0.069454494	0.016214223	5.069454494	4032
250	0.079735043	0.018871265	250.079735	29151
6	0.014855656	0.019165528	6.014855656	2720
249	0.028614864	0.022128384	249.0286149	31391
7	0.065975836	0.022420112	7.065975836	480
248	0.148971942	0.024832496	248.1489719	61727
8	0.012388663	0.025326394	8.012388663	17408
247	0.013377715	0.02829426	247.0133777	15871
9	0.058450516	0.028512116	9.058450516	1168
246	0.061906562	0.031169428	246.0619066	14591
10	0.032684138	0.031454002	10.03268414	2832
245	0.015844708	0.034303798	245.0158447	12543
11	0.078745991	0.03458585	11.07874599	19328
244	0.036552761	0.037212821	244.0365528	62767
12	0.030217145	0.037410273	12.03021715	53120
243	0.018817534	0.040210135	243.0188175	45535
13	0.080831492	0.04050219	13.08083149	16480
242	0.008759061	0.043158734	242.0087591	32695
14	0.026738487	0.043261886	14.02673849	49568
241	0.057287907	0.045912513	241.0572879	31415
15	0.006536267	0.046096409	15.00653627	50016
240	0.011226054	0.048913427	240.0112261	29367
16	0.047539794	0.049081185	16.04753979	16912
239	0.000989052	0.051785089	239.0009891	14831
17	0.02927164	0.051870705	17.02927164	33576
238	0.01419888	0.054564983	238.0141989	62359
18	0.000559531	0.054606371	18.00055953	1796
237	0.039965258	0.057285153	237.0399653	30103
19	0.031862974	0.057484748	19.03186297	3304
236	0.024164097	0.060095617	236.0241641	45359
20	0.006096595	0.060178938	20.0060966	3048
235	0.006934703	0.062883674	235.0069347	15055
21	0.021391923	0.062960935	21.02139192	51664
234	0.001428724	0.065613674	234.0014287	45431
22	0.003629602	0.065627342	22.0036296	1368
233	0.022136776	0.068247727	233.0221368	15543
23	0.018419098	0.068356285	23.0184191	18672
232	0.004907382	0.070957936	232.0049074	47063
24	0.019967681	0.07102388	24.01996768	2276
231	0.025109602	0.073543475	231.0251096	64903
25	0.041154471	0.073717453	25.04115447	18600
230	0.007374375	0.076203213	230.0073744	29511
26	0.020952251	0.076276864	26.02095225	760
229	0.008265691	0.078788588	229.0082657	12223
27	0.067014105	0.078982358	27.0670141	2808
228	0.056794537	0.081227037	228.0567945	10943
28	0.0129211	0.081404798	28.0129211	16664
227	0.010732684	0.083881271	227.0107327	14907
29	0.014469682	0.083944874	29.01446968	268
226	0.034059164	0.086334261	226.0340592	27383
30	0.008744855	0.08644121	30.00874486	33794
225	0.009748113	0.088880771	225.0097481	14503
31	0.012002689	0.088934555	31.01200269	34188
224	0.00819953	0.09134483	224.0081995	26807
32	0.007481281	0.091383205	32.00748128	17592
223	0.012720939	0.093768615	223.0127209	47495
33	0.006589965	0.093815384	33.00658997	7152
222	0.011172356	0.096181686	222.0111724	59799
34	0.026067504	0.096270917	34.0260675	674
221	0.000935354	0.098589785	221.0009354	41327
35	0.004122972	0.098601777	35.00412297	17748
220	0.019203508	0.100905011	220.0192035	24663
36	0.000107396	0.100950305	36.0001074	37252
219	0.004414012	0.103272372	219.004414	42959
37	0.024418447	0.10333925	37.02441845	50132
218	0.002865429	0.105583103	218.0028654	59355
38	0.001091967	0.105592182	38.00109197	33564
217	0.00463286	0.107860739	217.0046329	14589
39	0.021445622	0.107919901	39.02144562	17140
216	0.001880858	0.110123112	216.0018809	44503
40	0.0036833	0.110135594	40.0036833	3292
215	0.007605686	0.11234105	215.0076057	47581
41	0.018978629	0.112400006	41.01897863	24560
214	0.002605539	0.114557303	214.0026055	62965
42	0.014963053	0.114595817	42.01496305	53252
213	0.033565794	0.116669872	213.0335658	11003
43	0.041714002	0.116832985	43.041714	36540
212	1.42E-05	0.118896699	212.0000142	31413
44	0.01249606	0.118923486	44.01249606	38292
211	0.00770616	0.121009042	211.0077062	10427
45	0.01477529	0.121056608	45.01477529	35058
210	0.002987031	0.12312223	210.002987	64405
46	0.009523234	0.12314838	46.00952323	21668
209	0.007227422	0.125191183	209.0072274	42407
47	0.00724997	0.125221078	47.00724997	19602
208	0.005678839	0.127246667	208.0056788	58803
48	0.008798553	0.127276192	48.00879855	3206
207	0.009694415	0.129265373	207.0096944	8487
49	0.012056388	0.129309177	49.01205639	5676
206	0.008145832	0.131269856	206.0081458	24883
50	0.009277292	0.1313045	50.00927729	49418
205	0.013173073	0.133235858	205.0131731	10119
51	0.001585337	0.13326483	51.00158534	54036
204	0.01162449	0.135189366	204.0116245	26515
52	0.006304466	0.135224104	52.00630447	16426
203	0.001387488	0.137133916	203.0013875	44491
53	0.004176671	0.137144554	53.00417667	23764
202	0.014091483	0.13900917	202.0140915	25107
54	0.001397574	0.139038392	54.00139757	52210
201	0.002112169	0.140905519	201.0021122	42493
55	0.002946157	0.140914932	55.00294616	35814
200	0.050641015	0.142664669	200.050641	12793
56	0.001145665	0.142759754	56.00114567	39580
199	0.004579162	0.144572072	199.0045792	12665
57	0.000479164	0.144581228	57.00047916	34134
198	0.027535359	0.146328432	198.0275354	9739
58	0.003231166	0.146383343	58.00323117	20588
197	0.002493661	0.148144916	197.0024937	43933
59	0.000957902	0.148150987	59.0009579	16602
196	0.004799986	0.149887213	196.0048	9811
60	0.000764173	0.149896859	60.00076417	38140
195	0.001509091	0.151613696	195.0015091	13093
61	0.017801813	0.151646675	61.01780181	17382
194	0.005524666	0.153302225	194.0055247	28117
62	3.95E-05	0.153311587	62.00003949	3534
193	0.009540242	0.154965466	193.0095402	12485
63	0.009770662	0.154997464	63.00977066	49430
192	0.007991659	0.156612498	192.0079917	24789
64	0.011319245	0.156644003	64.01131924	37126
191	0.028699712	0.158198204	191.0286997	58645
65	0.006797836	0.158255224	65.00679784	16438
190	0.013404384	0.159816396	190.0134044	10029
66	0.008346419	0.159850776	66.00834642	4134
189	0.010146549	0.16138959	189.0101465	11651
67	0.004330843	0.161412104	67.00433084	17846
188	0.015871377	0.162923383	188.0158714	10637
68	0.005879426	0.162956654	68.00587943	5542
187	0.01087123	0.16444811	187.0108712	9653
69	0.024626318	0.164501494	69.02462632	52150
186	0.059400076	0.165867898	186.0594001	8373
70	0.006863997	0.165965918	70.006864	18222
185	0.013338223	0.167402201	185.0133382	8245
71	0.05292585	0.167498454	71.05292585	1982
184	0.043061998	0.16880041	184.043062	44985
72	0.023707908	0.168895745	72.02370791	54534
183	0.016311049	0.170253865	183.016311	41237
73	0.002999856	0.170280944	73.00299986	20678
182	0.020326624	0.171638089	182.0203266	61425
74	0.020735082	0.171694614	74.02073508	5174
181	0.005031296	0.173023123	181.0050313	11737
75	0.000532863	0.173030641	75.00053286	56518
180	0.022793617	0.174338052	180.0227936	25585
76	0.005533009	0.174375608	76.00553301	4686
179	0.004046726	0.175675873	179.0040467	9317
77	0.001517433	0.175683107	77.00151743	18398
178	0.002498143	0.176965319	178.0024981	25713
78	0.003066016	0.176972411	78.00306602	6094
177	0.001961225	0.178227929	177.0019612	12165
79	0.049127869	0.178291715	79.04912787	8142
176	0.000412642	0.179466257	176.0004126	28561
80	0.023731774	0.179495794	80.02373177	33025
175	0.004428218	0.180672347	175.0044282	8837
81	0.00982436	0.180689422	81.00982436	22934
174	0.002879635	0.181859674	174.0028796	25233
82	0.020758948	0.181887388	82.02075895	33
173	0.027769898	0.18299109	173.0277699	23519
83	0.000556728	0.183023595	83.00055673	35009
172	0.012844853	0.18414296	172.0128449	8233
84	0.012357514	0.184171229	84.01235751	21390
171	0.001910265	0.185264197	171.0019103	22943
85	0.058419367	0.185330286	85.05841937	7070
170	0.015817678	0.186332781	170.0158177	41225
86	0.009890521	0.186360308	86.00989052	40862
169	0.039144158	0.187366723	169.0391442	41425
87	0.029738342	0.187438727	87.02973834	55798
168	0.030649469	0.188408835	168.0306495	40895
88	0.006411862	0.188446637	88.00641186	37310
167	0.013790357	0.189433338	167.0137904	11409
89	0.015412385	0.189462371	89.01541238	8400
166	0.007914095	0.190420843	166.0079141	57335
90	0.02721317	0.190454862	90.02721317	21022
165	0.021315676	0.191364365	165.0213157	10721
91	0.007381233	0.191391438	91.00738123	817
164	0.010381088	0.192305422	164.0103811	21495
92	0.017945538	0.192331415	92.01794554	585
163	0.030583308	0.193192632	163.0305833	22967
93	0.00491424	0.193224316	93.00491424	34737
162	0.015793812	0.194085729	162.0157938	38175
94	0.009914386	0.194108013	94.00991439	35721
161	0.027261328	0.194930475	161.0272613	10945
95	0.001065299	0.194954314	95.0010653	55774
160	0.018260805	0.195767021	160.0182608	39855
96	0.006941561	0.195787584	96.00694156	2729
159	0.001401694	0.196583826	159.0014017	10369
97	0.022236889	0.1966025	97.02223689	18833
158	0.026291957	0.197342337	158.026292	4719
98	0.002034669	0.197364009	98.00203467	25552
157	0.021291811	0.198098733	157.0212918	7671
99	0.003583252	0.198117129	99.00358325	965
156	0.000432324	0.198840706	156.0004323	4143
100	0.021318479	0.198856225	100.0213185	1829
155	0.023758804	0.199525696	155.0237588	20711
101	0.001116259	0.199542825	101.0011163	36805
154	0.003405149	0.200215349	154.0034051	37135
102	0.02230305	0.200232382	102.022303	36761
153	0.001856566	0.20086648	153.0018566	49439
103	0.042150871	0.200894504	103.0421509	51697
152	0.055949571	0.201457957	152.0559496	3071
104	0.018824391	0.20150374	104.0188244	33209
151	0.001377828	0.202090492	151.0013778	7319
105	0.018438908	0.202102107	105.0184389	597
150	0.030089938	0.202647993	150.0300899	2495
106	0.036174135	0.202685151	106.0361741	19845
149	0.008903147	0.2032082	149.0089031	14822
107	0.010407757	0.203218538	107.0104078	35733
148	0.007354565	0.203731812	148.0073546	18935
108	0.035449454	0.20375362	108.0354495	1539
147	0.056389243	0.204205312	147.0563892	50039
109	0.007434931	0.204236265	109.0074349	19109
146	0.032078193	0.204689542	146.0320782	37159
110	0.033680048	0.204719715	110.03368	16697
145	0.014848799	0.205143955	145.0148488	6855
111	0.004967938	0.205152545	111.0049679	17429
144	0.013300216	0.205565591	144.0133002	19159
112	0.006516521	0.205573675	112.0065165	5125
143	0.019249858	0.205958785	143.0192499	19963
113	0.003737425	0.20596758	113.0037374	33571
142	0.023265433	0.206327481	142.0232654	239
114	0.012053585	0.206340091	114.0120536	2285
141	0.021716851	0.206672736	141.0217169	16635
115	0.006328758	0.206682036	115.0063288	3299
140	0.01943762	0.206992643	140.0194376	21789
116	0.024345003	0.207006034	116.024345	40837
139	0.016179786	0.207287217	139.0161798	4023
117	0.019317762	0.20729717	117.0193178	49589
138	0.000884458	0.207559203	138.0008845	3215
118	0.020866345	0.207564742	118.0208663	37285
137	0.018646779	0.207797324	137.0186468	695
119	0.000664125	0.207801759	119.0006641	37733
136	0.001609139	0.208017964	136.0016091	5309
120	0.00083076	0.208018461	120.0008308	1291
135	0.006861194	0.20820826	135.0068612	18923
121	0.015620255	0.20821227	121.0156203	2227
134	0.004581964	0.208374485	134.004582	38301
122	0.021126235	0.208378412	122.0211262	33675
133	0.00132413	0.208515226	133.0013241	1303
123	0.041479889	0.20852066	123.0414799	2803
132	0.007048957	0.208629391	132.007049	12572
124	0.018153409	0.208631957	124.0181534	683
131	0.003791123	0.208719044	131.0037911	2983
125	0.015519781	0.208720518	125.0155198	39381
130	0.00224254	0.208782951	130.0022425	19379
126	0.013246518	0.208783738	126.0132465	17235
129	0.012328107	0.208820988	129.0123281	34759
127	0.012546955	0.208821622	127.012547	22757
128	0.010779525	0.208834048	128.0107795	51155

		 * */
		private void Form1_Load(object sender, EventArgs e)
		{
			try
			{
				StringBuilder sb = new StringBuilder();
				for (int i = 0; i < 65535; i++)
				{
					double Rtop = 0;
					double Rbottom = 0;
					for (int j = 0; j < 16; j++)
					{
						if ((i & (1 << j)) != 0)
						{
							Rtop += (1f / Rarray[j]);
						}
						else
						{
							Rbottom += (1f / Rarray[j]);
						}
					}

					Rtop = 1f / Rtop;
					Rbottom = 1f / Rbottom;

					double currency = 256 / (Rtop + Rbottom); // i = v/r
					double voltage = currency * Rbottom;//v=i*r

					value v = new value();
					v.voltage = voltage;
					v.conf = i;
					v.cur = currency;
					v.error = Math.Abs(Math.Floor(v.voltage) - v.voltage);
					v.iv = (int)Math.Floor(v.voltage);

					if (values[v.iv] == null || v.error * v.cur < values[v.iv].error * v.cur)
					{
						values[v.iv] = v;
					}

				}

				for (int i = 0; i < 256; i++)
				{
					sb.Append(values[i].iv + "\t" + values[i].error + "\t" + values[i].cur + "\t" + values[i].voltage + "\t" + values[i].conf + "\r\n");
				}

				textBox1.Text = sb.ToString();
			}
			catch (Exception ex)
			{
			}

		}

	}
}


